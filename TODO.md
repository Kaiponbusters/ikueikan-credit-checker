# 育英館大学単位管理システム αテスト準備 TODO

## 🎯 プロジェクト目標
現在のローカル環境システムを、複数ユーザーが利用可能なWebアプリケーションに拡張し、αテストを実施する。

---

## 📋 Phase 1: 認証・ユーザー管理システム実装

### 1.1 認証基盤の選択・実装
- [ ] **Next.js App Router対応の認証ライブラリ選択**
  - [ ] NextAuth.js v5 (Auth.js) の調査・検討
  - [ ] Clerk、Supabase Auth、Firebase Authとの比較
  - [ ] 推奨: NextAuth.js v5 (無料、柔軟性、Next.js 15対応)
- [ ] **NextAuth.js v5 セットアップ**
  - [ ] `npm install next-auth@beta` インストール
  - [ ] `app/api/auth/[...nextauth]/route.ts` 作成
  - [ ] 環境変数設定 (`NEXTAUTH_SECRET`, `NEXTAUTH_URL`)
  - [ ] プロバイダー設定（Email + Password、Google OAuth等）

### 1.2 ユーザー管理機能
- [ ] **ユーザー登録システム**
  - [ ] 招待制ユーザー登録フォーム作成
  - [ ] 招待コード生成・検証機能
  - [ ] ユーザープロファイル管理（学生ID、学年、学部等）
- [ ] **管理者機能**
  - [ ] 管理者ダッシュボード作成
  - [ ] ユーザー招待機能
  - [ ] ユーザー一覧・管理機能
  - [ ] 利用統計ダッシュボード

### 1.3 認証保護とミドルウェア
- [ ] **ページ保護**
  - [ ] `middleware.ts` 作成（認証チェック）
  - [ ] ログインページ (`app/auth/signin/page.tsx`)
  - [ ] ユーザー登録ページ (`app/auth/register/page.tsx`)
- [ ] **セッション管理**
  - [ ] セッションプロバイダー設定
  - [ ] クライアントサイドセッション取得
  - [ ] 自動ログアウト機能

---

## 📋 Phase 2: データベース設計・実装

### 2.1 データベース選択・セットアップ
- [ ] **データベース選択**
  - [ ] PostgreSQL (推奨: Vercel Postgres、Supabase、PlanetScale)
  - [ ] 無料プランでの制限確認
  - [ ] 推奨: Vercel Postgres (Vercelデプロイとの親和性)
- [ ] **ORM・データベースツール**
  - [ ] Prisma セットアップ (`npm install prisma @prisma/client`)
  - [ ] データベース接続設定
  - [ ] スキーマ設計

### 2.2 データベーススキーマ設計
- [ ] **Prismaスキーマ作成** (`prisma/schema.prisma`)
  ```sql
  // メインテーブル設計
  - users (id, email, name, studentId, grade, department, createdAt)
  - user_courses (id, userId, courseId, status, completedAt, credits)
  - courses (既存データのインポート用)
  - user_sessions (NextAuth.js用)
  ```
- [ ] **データベースマイグレーション**
  - [ ] 初回マイグレーション実行
  - [ ] シードデータ作成（courses.jsonからのインポート）

### 2.3 データ移行・統合
- [ ] **既存データの統合**
  - [ ] `courses.json` → データベースインポートスクリプト
  - [ ] `requirements.json` → データベース化検討
  - [ ] ローカルストレージ → データベース移行機能
- [ ] **データバックアップ・復元**
  - [ ] 定期バックアップ設定
  - [ ] データエクスポート機能

---

## 📋 Phase 3: API・データ処理の再設計

### 3.1 サーバーサイドAPI実装
- [ ] **履修データAPI** (`app/api/user-courses/`)
  - [ ] `GET /api/user-courses` - 履修データ取得
  - [ ] `POST /api/user-courses` - 履修登録
  - [ ] `PUT /api/user-courses/[id]` - 履修状態更新
  - [ ] `DELETE /api/user-courses/[id]` - 履修削除
- [ ] **科目データAPI** (`app/api/courses/`)
  - [ ] `GET /api/courses` - 科目一覧・検索
  - [ ] `GET /api/courses/[id]` - 科目詳細
- [ ] **ユーザーデータAPI** (`app/api/users/`)
  - [ ] `GET /api/users/profile` - プロファイル取得
  - [ ] `PUT /api/users/profile` - プロファイル更新

### 3.2 データ処理の最適化
- [ ] **サーバーサイド集計処理**
  - [ ] 単位計算APIエンドポイント
  - [ ] 進捗計算の最適化
  - [ ] キャッシュ機能実装
- [ ] **リアルタイム同期**
  - [ ] 複数デバイス間でのデータ同期
  - [ ] 楽観的更新 (Optimistic Updates)

---

## 📋 Phase 4: UI/UX改善・マルチユーザー対応

### 4.1 認証関連UI
- [ ] **ログイン・登録画面**
  - [ ] モダンなログインフォーム
  - [ ] ユーザー登録フロー（招待コード含む）
  - [ ] パスワードリセット機能
- [ ] **ユーザーダッシュボード**
  - [ ] ヘッダーにユーザー情報表示
  - [ ] ログアウト機能
  - [ ] プロファイル編集画面

### 4.2 データローディング・エラーハンドリング
- [ ] **ローディング状態管理**
  - [ ] Suspense境界の実装
  - [ ] スケルトンUIの追加
  - [ ] Progressive Loading
- [ ] **エラーハンドリング強化**
  - [ ] Error Boundaryの拡張
  - [ ] ネットワークエラー対応
  - [ ] ユーザーフレンドリーなエラーメッセージ

### 4.3 パフォーマンス最適化
- [ ] **データフェッチング最適化**
  - [ ] React Query / SWR導入検討
  - [ ] 適切なキャッシュ戦略
  - [ ] 無限スクロール・ページネーション

---

## 📋 Phase 5: セキュリティ・プライバシー対策

### 5.1 セキュリティ強化
- [ ] **APIセキュリティ**
  - [ ] CSRF保護 (NextAuth.jsで自動対応)
  - [ ] XSS対策確認
  - [ ] SQLインジェクション対策 (Prismaで自動対応)
- [ ] **認証セキュリティ**
  - [ ] セッションタイムアウト設定
  - [ ] ブルートフォース攻撃対策
  - [ ] 2FA実装検討

### 5.2 プライバシー保護
- [ ] **データ保護**
  - [ ] 個人情報の暗号化
  - [ ] データ保持期間ポリシー
  - [ ] GDPR準拠確認（必要に応じて）
- [ ] **ユーザー制御**
  - [ ] データダウンロード機能
  - [ ] アカウント削除機能
  - [ ] プライバシー設定

---

## 📋 Phase 6: デプロイメント・インフラ

### 6.1 本番環境準備
- [ ] **Vercel本番デプロイ**
  - [ ] Vercelアカウント設定
  - [ ] 環境変数設定（本番用）
  - [ ] カスタムドメイン設定検討
- [ ] **データベース本番環境**
  - [ ] Vercel Postgres 本番インスタンス
  - [ ] 本番用マイグレーション実行
  - [ ] 初期データセットアップ

### 6.2 監視・メンテナンス
- [ ] **ログ・監視**
  - [ ] Vercel Analytics設定
  - [ ] エラー監視 (Sentry等)
  - [ ] パフォーマンス監視
- [ ] **バックアップ・復旧**
  - [ ] 自動バックアップ設定
  - [ ] 災害復旧計画
  - [ ] データベース監視

---

## 📋 Phase 7: αテスト準備・実施

### 7.1 テスト環境構築
- [ ] **ステージング環境**
  - [ ] ステージング用デプロイ設定
  - [ ] テストデータ準備
  - [ ] E2Eテスト実行
- [ ] **αテスト計画**
  - [ ] テストユーザー選定（5-10名）
  - [ ] テストシナリオ作成
  - [ ] フィードバック収集方法確定

### 7.2 ドキュメント・サポート
- [ ] **ユーザーガイド**
  - [ ] システム使用方法マニュアル
  - [ ] FAQ作成
  - [ ] トラブルシューティングガイド
- [ ] **サポート体制**
  - [ ] フィードバック収集フォーム
  - [ ] バグ報告システム
  - [ ] 緊急時連絡方法

---

## 🚀 実装優先順位

### Week 1-2: 基盤実装
1. NextAuth.js v5 セットアップ
2. Prismaデータベース設計・実装
3. 基本的なAPI構築

### Week 3-4: 認証・ユーザー管理
1. ユーザー登録・ログイン機能
2. 招待制システム実装
3. 管理者機能

### Week 5-6: データ移行・統合
1. 既存データのデータベース化
2. UI/APIの統合
3. パフォーマンス最適化

### Week 7-8: セキュリティ・デプロイ
1. セキュリティ強化
2. 本番環境デプロイ
3. αテスト環境準備

---

## 📊 技術スタック（最終形態）

### フロントエンド
- Next.js 15 (App Router)
- TypeScript
- Tailwind CSS
- Lucide React

### バックエンド・認証
- NextAuth.js v5
- Prisma ORM
- Vercel Postgres

### デプロイ・インフラ
- Vercel (ホスティング)
- Vercel Postgres (データベース)
- Vercel Analytics (監視)

### 開発・テスト
- Playwright (E2Eテスト)
- TypeScript (型安全性)
- Git (バージョン管理)

---

## 📝 注意事項・リスク

### 技術的リスク
- NextAuth.js v5 は beta版（安定性要確認）
- データベース移行時のデータ整合性
- 大量データ処理のパフォーマンス

### 運用リスク
- ユーザーサポート体制
- サーバー費用（ユーザー数増加時）
- セキュリティインシデント対応

### 対策
- 段階的リリース（αテスト → βテスト → 正式リリース）
- 詳細なテスト・監視体制
- バックアップ・復旧計画の策定

---

**作成日**: 2024年12月27日  
**最終更新**: 2024年12月27日  
**対象バージョン**: ikueikan-credit-checker v1.0 → v2.0 (Multi-user) 