---
description: 
globs: 
alwaysApply: false
---
# å‹å®‰å…¨æ€§ã‚¬ã‚¤ãƒ‰ - è‚²è‹±é¤¨å¤§å­¦å˜ä½ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ›¡ï¸ å‹å®‰å…¨æ€§ã®é‡è¦æ€§
ã“ã®ã‚¬ã‚¤ãƒ‰ã¯2024å¹´12æœˆ27æ—¥ã«ç™ºç”Ÿã—ãŸRuntime Errorã®ä¿®æ­£çµŒé¨“ã‚’åŸºã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚å‹ã®ä¸æ•´åˆã«ã‚ˆã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã®å…·ä½“çš„ãªæŒ‡é‡ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ“‹ å¿…é ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### JSONãƒ‡ãƒ¼ã‚¿ã¨TypeScriptå‹ã®æ•´åˆæ€§
- [ ] [courses.json](mdc:app/lib/data/courses.json)ã®æ§‹é€ ã¨[types.ts](mdc:app/lib/types.ts)ã®`Course`å‹ãŒä¸€è‡´ã—ã¦ã„ã‚‹
- [ ] [requirements.json](mdc:app/lib/data/requirements.json)ã®æ§‹é€ ã¨è¦ä»¶ãƒã‚§ãƒƒã‚«ãƒ¼ã®æœŸå¾…ã™ã‚‹å‹ãŒä¸€è‡´ã—ã¦ã„ã‚‹
- [ ] ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆ`?:`ï¼‰ãŒå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ­£ç¢ºã«åæ˜ ã—ã¦ã„ã‚‹
- [ ] å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`as Type[]`ï¼‰ãŒJSONã‚¤ãƒ³ãƒãƒ¼ãƒˆæ™‚ã«é©åˆ‡ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

### é–¢æ•°ãƒ¬ãƒ™ãƒ«ã§ã®å‹å®‰å…¨æ€§
- [ ] ã™ã¹ã¦ã®é–¢æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å‹æ³¨é‡ˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ã™ã¹ã¦ã®é–¢æ•°ã®æˆ»ã‚Šå€¤å‹ãŒæ˜ç¤ºã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‡¦ç†ã§nullãƒã‚§ãƒƒã‚¯ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] é…åˆ—æ“ä½œï¼ˆmap, filterç­‰ï¼‰å‰ã«é…åˆ—ã®å­˜åœ¨ç¢ºèªã‚’ã—ã¦ã„ã‚‹

## ğŸš¨ ã‚ˆãã‚ã‚‹å‹ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å¯¾å‡¦æ³•

### 1. JSONãƒ‡ãƒ¼ã‚¿å‚ç…§ã‚¨ãƒ©ãƒ¼
```typescript
// âŒ å±é™ºï¼šJSONã®æ§‹é€ ã‚’ä»®å®šã—ãŸã‚¢ã‚¯ã‚»ã‚¹
const requirements = requirementsData.graduationRequirements; // undefined ã«ãªã‚‹å¯èƒ½æ€§

// âœ… å®‰å…¨ï¼šå®Ÿéš›ã®JSONæ§‹é€ ã«åŸºã¥ãã‚¢ã‚¯ã‚»ã‚¹
const requirements = requirementsData.graduationRequirement;
```

### 2. ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä¸é©åˆ‡ãªå‡¦ç†
```typescript
// âŒ å±é™ºï¼šã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç›´æ¥ä½¿ç”¨
function processCourse(course: Course) {
  return course.department.toLowerCase(); // department ãŒ undefined ã®å ´åˆã‚¨ãƒ©ãƒ¼
}

// âœ… å®‰å…¨ï¼šnullãƒã‚§ãƒƒã‚¯ä»˜ãã®å‡¦ç†
function processCourse(course: Course) {
  return course.department?.toLowerCase() || 'unknown';
}
```

### 3. é…åˆ—æ“ä½œæ™‚ã®æœªå®šç¾©ãƒã‚§ãƒƒã‚¯ä¸è¶³
```typescript
// âŒ å±é™ºï¼šé…åˆ—ã®å­˜åœ¨ã‚’ä»®å®šã—ãŸæ“ä½œ
requirements.map(req => processRequirement(req)); // requirements ãŒ undefined ã®å ´åˆã‚¨ãƒ©ãƒ¼

// âœ… å®‰å…¨ï¼šå­˜åœ¨ç¢ºèªä»˜ãã®æ“ä½œ
requirements?.map(req => processRequirement(req)) || [];
```

## ğŸ”§ å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### JSONãƒ‡ãƒ¼ã‚¿ã®å®‰å…¨ãªèª­ã¿è¾¼ã¿
```typescript
// ãƒ•ã‚¡ã‚¤ãƒ«ï¼špage.tsx
import coursesData from './lib/data/courses.json';

// å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã§å‹å®‰å…¨æ€§ã‚’ç¢ºä¿
const [courses] = useState<Course[]>(coursesData.courses as Course[]);
```

### å‹ã‚¬ãƒ¼ãƒ‰ã®æ´»ç”¨
```typescript
// å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°ã®ä¾‹
function isCourse(obj: any): obj is Course {
  return obj && 
         typeof obj.id === 'string' && 
         typeof obj.name === 'string' &&
         typeof obj.credits === 'number';
}

// ä½¿ç”¨ä¾‹
if (isCourse(data)) {
  // data ã¯ Course å‹ã¨ã—ã¦å®‰å…¨ã«ä½¿ç”¨å¯èƒ½
  console.log(data.credits);
}
```

### å®‰å…¨ãªé…åˆ—å‡¦ç†
```typescript
// å®‰å…¨ãªé…åˆ—æ“ä½œã®ãƒ‘ã‚¿ãƒ¼ãƒ³
function processUserCourses(courses: Course[], userCourses: UserCourse[]): ProcessedCourse[] {
  if (!courses || !userCourses) {
    return [];
  }
  
  return userCourses
    .map(uc => {
      const course = courses.find(c => c.id === uc.courseId);
      if (!course) return null; // è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®å®‰å…¨ãªå‡¦ç†
      
      return {
        ...course,
        status: uc.status
      };
    })
    .filter((course): course is ProcessedCourse => course !== null); // å‹ã‚¬ãƒ¼ãƒ‰ã§nullã‚’é™¤å¤–
}
```

## ğŸ“ é–‹ç™ºæ™‚ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. å®šæœŸçš„ãªå‹ãƒã‚§ãƒƒã‚¯
```bash
# TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å®šæœŸçš„ã«å®Ÿè¡Œ
npm run build

# å‹ã‚¨ãƒ©ãƒ¼ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯
npx tsc --noEmit
```

### 2. æ®µéšçš„ãªå‹å¼·åŒ–
```typescript
// Phase 1: åŸºæœ¬çš„ãªå‹ã‚’è¨­å®š
interface BasicCourse {
  id: string;
  name: string;
  credits: number;
}

// Phase 2: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 
interface Course extends BasicCourse {
  department?: string;
  notes?: string;
}

// Phase 3: ã‚ˆã‚Šè©³ç´°ãªå‹åˆ¶ç´„ã‚’è¿½åŠ 
interface StrictCourse extends Course {
  id: `${string}-${string}-${number}`; // ç§‘ç›®ã‚³ãƒ¼ãƒ‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
  credits: 1 | 2 | 4 | 6; // è¨±å¯ã•ã‚Œã‚‹å˜ä½æ•°ã®ã¿
}
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
```typescript
// å‹å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
function calculateCredits(courses: Course[], userCourses: UserCourse[]): number {
  try {
    if (!Array.isArray(courses) || !Array.isArray(userCourses)) {
      throw new Error('Invalid input: expected arrays');
    }
    
    return userCourses.reduce((total, uc) => {
      const course = courses.find(c => c.id === uc.courseId);
      if (!course) {
        console.warn(`Course not found: ${uc.courseId}`);
        return total;
      }
      
      return total + (course.credits || 0);
    }, 0);
  } catch (error) {
    console.error('Error calculating credits:', error);
    return 0; // å®‰å…¨ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
  }
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### å‹å®‰å…¨æ€§ã®ãƒ†ã‚¹ãƒˆä¾‹
```typescript
// å‹ã®æ•´åˆæ€§ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ä¾‹
describe('Type Safety', () => {
  test('courses.json matches Course type', () => {
    const courses = coursesData.courses as Course[];
    
    courses.forEach(course => {
      expect(typeof course.id).toBe('string');
      expect(typeof course.name).toBe('string');
      expect(typeof course.credits).toBe('number');
      
      // ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒ†ã‚¹ãƒˆ
      if (course.department) {
        expect(typeof course.department).toBe('string');
      }
    });
  });
});
```

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯
- [TypeScript Handbook - Type Guards](mdc:https:/www.typescriptlang.org/docs/handbook/2/narrowing.html)
- [TypeScript Deep Dive - Type Assertion](mdc:https:/basarat.gitbook.io/typescript/type-system/type-assertion)
- [React TypeScript Cheatsheet](mdc:https:/react-typescript-cheatsheet.netlify.app)

---
**æœ€çµ‚æ›´æ–°**: 2024å¹´12æœˆ27æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0 (åˆå›ä½œæˆ)
